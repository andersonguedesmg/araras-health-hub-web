<app-breadcrumb [itemsBreadcrumb]="itemsBreadcrumb"></app-breadcrumb>

<app-spinner [loading]="isLoading"></app-spinner>
<app-confirm-dialog></app-confirm-dialog>

<div class="container mx-auto">
  <div class="card mt-10">
    <app-table-header [title]="title"></app-table-header>

    <ng-container *ngIf="criticalStocks$ | async as stocks">
      <app-table
        [value]="stocks"
        [rows]="5"
        [rowsPerPageOptions]="[5, 10, 25]"
        [lazy]="true"
        (onLazyLoad)="loadCriticalStocks($event)"
        [totalRecords]="totalRecords"
        [globalFilterFields]="[
          'product.name',
          'product.mainCategory',
          'product.subCategory',
          'product.presentationForm',
          'currentQuantity',
          'minQuantity'
        ]"
        [loading]="isLoading"
        [colspan]="6"
      >
        <ng-template #captionTemplate let-dt>
          <div class="flex items-center justify-between">
            <p-iconfield>
              <p-inputicon styleClass="pi pi-search" />
              <input
                pInputText
                type="text"
                (input)="onSearchInput($any($event.target).value)"
                placeholder="Pesquisar..."
              />
            </p-iconfield>
            <div>
              <p-button
                label="Exportar"
                icon="pi pi-upload"
                severity="secondary"
                (click)="exportCriticalStocks()"
              />
            </div>
          </div>
        </ng-template>

        <ng-template #headerTemplate>
          <tr>
            <th style="min-width: 20rem" pSortableColumn="product.name">
              PRODUTO
            </th>
            <th style="min-width: 12rem" pSortableColumn="product.mainCategory">
              CATEGORIA PRINCIPAL
            </th>
            <th style="min-width: 15rem" pSortableColumn="product.subCategory">
              SUBCATEGORIA
            </th>
            <th
              style="min-width: 15rem"
              pSortableColumn="product.presentationForm"
            >
              FORMA DE APRESENTAÇÃO
            </th>
            <th style="min-width: 12rem" pSortableColumn="currentQuantity">
              QUANTIDADE ATUAL
            </th>
            <th style="min-width: 12rem" pSortableColumn="minQuantity">
              QUANTIDADE MÍNIMA
            </th>
          </tr>
        </ng-template>

        <ng-template #bodyTemplate let-stock>
          <tr>
            <td>{{ stock.product.name }}</td>
            <td>{{ stock.product.mainCategory }}</td>
            <td>{{ stock.product.subCategory }}</td>
            <td>{{ stock.product.presentationForm }}</td>
            <td>{{ stock.currentQuantity }}</td>
            <td>{{ stock.minQuantity }}</td>
          </tr>
        </ng-template>
      </app-table>
    </ng-container>
  </div>
</div>
