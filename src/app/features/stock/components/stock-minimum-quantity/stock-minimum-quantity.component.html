<app-breadcrumb [itemsBreadcrumb]="itemsBreadcrumb"></app-breadcrumb>

<app-spinner [loading]="isLoading"></app-spinner>

<div class="container mx-auto">
  <div class="card mt-10">
    <app-table-header [title]="title"></app-table-header>

    <ng-container *ngIf="stockMinQuantities$ | async as stocks">
      <p-table
        #dt
        [value]="stocks"
        [rows]="lastLazyEvent.rows"
        [paginator]="true"
        [rowHover]="true"
        [rowsPerPageOptions]="[5, 10, 25]"
        [lazy]="true"
        [showCurrentPageReport]="true"
        currentPageReportTemplate="Mostrando {first} a {last} dos {totalRecords} Registros"
        (onLazyLoad)="loadMinQuantities($event)"
        [totalRecords]="totalRecords"
        [globalFilterFields]="[
          'productId',
          'productName',
          'productMainCategory',
          'productSubCategory',
          'productPresentationForm',
          'minQuantity'
        ]"
        [loading]="isLoading"
        editMode="cell"
        dataKey="id"
        [tableStyle]="{ 'min-width': '75rem' }"
        [style]="{ 'font-size': '14px' }"
        (onEditInit)="onEditInit($event)"
        (onEditComplete)="onEditComplete($event)"
      >
        <ng-template pTemplate="caption" let-dt>
          <div class="flex items-center justify-between">
            <p-iconfield>
              <p-inputicon styleClass="pi pi-search" />
              <input
                pInputText
                type="text"
                (input)="onSearchInput($any($event.target).value)"
                placeholder="Pesquisar..."
              />
            </p-iconfield>
          </div>
        </ng-template>

        <ng-template pTemplate="header">
          <tr>
            <th style="min-width: 20rem" pSortableColumn="productName">
              PRODUTO
            </th>
            <th style="min-width: 15rem" pSortableColumn="productMainCategory">
              CATEGORIA PRINCIPAL
            </th>
            <th style="min-width: 15rem" pSortableColumn="productSubCategory">
              SUBCATEGORIA
            </th>
            <th
              style="min-width: 15rem"
              pSortableColumn="productPresentationForm"
            >
              FORMA DE APRESENTAÇÃO
            </th>
            <th style="min-width: 15rem" pSortableColumn="minQuantity">
              QUANTIDADE MÍNIMA
            </th>
          </tr>
        </ng-template>

        <ng-template
          pTemplate="body"
          let-stock
          let-editing="editing"
          let-ri="rowIndex"
        >
          <tr>
            <td>{{ stock.productName }}</td>
            <td>{{ stock.productMainCategory }}</td>
            <td>{{ stock.productSubCategory }}</td>
            <td>{{ stock.productPresentationForm }}</td>

            <td [pEditableColumn]="stock" pEditableColumnField="minQuantity">
              <p-cellEditor>
                <ng-template #input>
                  <p-inputNumber
                    [(ngModel)]="stock.minQuantity"
                    mode="decimal"
                    [min]="0"
                    required
                    class="w-full"
                    fluid
                  />
                </ng-template>
                <ng-template pTemplate="output">
                  {{ stock.minQuantity }}
                </ng-template>
              </p-cellEditor>
            </td>
          </tr>
        </ng-template>
      </p-table>
    </ng-container>
  </div>
</div>
